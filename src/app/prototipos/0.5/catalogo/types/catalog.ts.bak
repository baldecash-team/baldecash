// types/catalog.ts - BaldeCash Catálogo Types v0.5
// Configuración simplificada: solo ColorSelector tiene 2 versiones

import { ReactNode } from 'react';

// ============================================
// Re-exportar tipos de v0.4 que se mantienen
// ============================================

// Tipos base
export type UsageType =
  | 'estudios'
  | 'gaming'
  | 'diseño'
  | 'oficina'
  | 'programación';

export type SortOption =
  | 'recommended'
  | 'price_asc'
  | 'price_desc'
  | 'quota_asc'
  | 'newest'
  | 'popular';

export type QuotaFrequency = 'weekly' | 'biweekly' | 'monthly';

// Plazos disponibles para financiamiento
export type TermMonths = 12 | 18 | 24 | 36 | 48;

export const termOptions: TermMonths[] = [12, 18, 24, 36, 48];

export const termLabels: Record<TermMonths, string> = {
  12: '12 meses',
  18: '18 meses',
  24: '24 meses',
  36: '36 meses',
  48: '48 meses',
};

// Calcula la cuota mensual según el plazo seleccionado
export function calculateQuotaForTerm(price: number, term: TermMonths): number {
  const interestFactors: Record<TermMonths, number> = {
    12: 1.08,
    18: 1.12,
    24: 1.15,
    36: 1.22,
    48: 1.30,
  };

  const totalWithInterest = price * interestFactors[term];
  return Math.round(totalWithInterest / term);
}

// Modo de Precio
export type PricingMode = 'static' | 'interactive';

export type InitialPaymentPercent = 0 | 10 | 15 | 20;

export const initialOptions: InitialPaymentPercent[] = [0, 10, 15, 20];

export const initialLabels: Record<InitialPaymentPercent, string> = {
  0: 'Sin inicial',
  10: '10%',
  15: '15%',
  20: '20%',
};

// Calcula la cuota mensual considerando el pago inicial
export function calculateQuotaWithInitial(
  price: number,
  term: TermMonths,
  initialPercent: InitialPaymentPercent
): { quota: number; initialAmount: number; financedAmount: number } {
  const initialAmount = Math.round(price * (initialPercent / 100));
  const financedAmount = price - initialAmount;

  const interestFactors: Record<TermMonths, number> = {
    12: 1.08,
    18: 1.12,
    24: 1.15,
    36: 1.22,
    48: 1.30,
  };

  const totalWithInterest = financedAmount * interestFactors[term];
  const quota = Math.round(totalWithInterest / term);

  return { quota, initialAmount, financedAmount };
}

// ============================================
// Product Tags
// ============================================

export type ProductTagType = 'mas_vendido' | 'recomendado' | 'cuota_baja' | 'oferta';

export interface ProductTagConfig {
  type: ProductTagType;
  label: string;
  color: string;
  bgColor: string;
}

export const productTagsConfig: Record<ProductTagType, ProductTagConfig> = {
  mas_vendido: {
    type: 'mas_vendido',
    label: 'Más vendido',
    color: '#ffffff',
    bgColor: '#f59e0b',
  },
  recomendado: {
    type: 'recomendado',
    label: 'Recomendado',
    color: '#ffffff',
    bgColor: '#8b5cf6',
  },
  cuota_baja: {
    type: 'cuota_baja',
    label: 'Cuota baja',
    color: '#ffffff',
    bgColor: '#06b6d4',
  },
  oferta: {
    type: 'oferta',
    label: 'Oferta',
    color: '#ffffff',
    bgColor: '#ef4444',
  },
};

export type TagDisplayVersion = 1 | 2 | 3;

export type ProductCondition = 'nuevo' | 'reacondicionado';

export type StockStatus = 'available' | 'limited' | 'on_demand' | 'out_of_stock';

export type GamaTier = 'económica' | 'estudiante' | 'profesional' | 'creativa' | 'gamer';

export type StorageType = 'ssd' | 'hdd' | 'emmc';

export type ProcessorBrand = 'intel' | 'amd' | 'apple';

export type ProcessorModel =
  | 'intel-celeron'
  | 'intel-core-i3'
  | 'intel-core-i5'
  | 'intel-core-i7'
  | 'intel-core-i9'
  | 'amd-ryzen-3'
  | 'amd-ryzen-5'
  | 'amd-ryzen-7'
  | 'amd-ryzen-9';

export type GpuType = 'integrated' | 'dedicated';

export type DisplayType = 'ips' | 'tn' | 'oled' | 'va';

export type Resolution = 'hd' | 'fhd' | 'qhd' | '4k';

// ============================================
// COLOR SELECTOR - ÚNICO COMPONENTE ITERABLE v0.5
// ============================================

export type ColorSelectorVersion = 1 | 2;

export interface ProductColor {
  id: string;
  name: string;
  hex: string;
  imageUrl?: string; // URL de imagen del producto en este color
}

export const colorSelectorVersionLabels: Record<ColorSelectorVersion, { name: string; description: string }> = {
  1: { name: 'Dots', description: 'Círculos compactos con tooltip' },
  2: { name: 'Swatches', description: 'Muestras grandes con nombre visible' },
};

// ============================================
// Estado de Filtros
// ============================================

export interface FilterState {
  brands: string[];
  priceRange: [number, number];
  quotaRange: [number, number];
  quotaFrequency: QuotaFrequency;
  usage: UsageType[];
  ram: number[];
  ramExpandable: boolean | null;
  storage: number[];
  storageType: StorageType[];
  processorBrand: ProcessorBrand[];
  processorModel: ProcessorModel[];
  gpuType: GpuType[];
  displaySize: number[];
  displayType: DisplayType[];
  resolution: Resolution[];
  touchScreen: boolean | null;
  refreshRate: number[];
  backlitKeyboard: boolean | null;
  numericKeypad: boolean | null;
  fingerprint: boolean | null;
  hasWindows: boolean | null;
  hasThunderbolt: boolean | null;
  hasEthernet: boolean | null;
  hasSDCard: boolean | null;
  hasHDMI: boolean | null;
  minUSBPorts: number | null;
  condition: ProductCondition[];
  stock: StockStatus[];
  gama: GamaTier[];
}

export const defaultFilterState: FilterState = {
  brands: [],
  priceRange: [1000, 8000],
  quotaRange: [40, 400],
  quotaFrequency: 'monthly',
  usage: [],
  ram: [],
  ramExpandable: null,
  storage: [],
  storageType: [],
  processorBrand: [],
  processorModel: [],
  gpuType: [],
  displaySize: [],
  displayType: [],
  resolution: [],
  touchScreen: null,
  refreshRate: [],
  backlitKeyboard: null,
  numericKeypad: null,
  fingerprint: null,
  hasWindows: null,
  hasThunderbolt: null,
  hasEthernet: null,
  hasSDCard: null,
  hasHDMI: null,
  minUSBPorts: null,
  condition: [],
  stock: [],
  gama: [],
};

// ============================================
// Filtros Aplicados (Chips)
// ============================================

export interface AppliedFilter {
  id: string;
  category: string;
  label: string;
  value: string | number | boolean;
}

// ============================================
// Opciones de Filtro
// ============================================

export interface FilterOption {
  value: string;
  label: string;
  count: number;
  icon?: string;
  logo?: string;
  disabled?: boolean;
}

export interface FilterSectionProps {
  title: string;
  tooltip?: FilterTooltipInfo;
  defaultExpanded?: boolean;
  children: ReactNode;
}

// ============================================
// Tooltips Explicativos
// ============================================

export interface FilterTooltipInfo {
  title: string;
  description: string;
  recommendation?: string;
}

export interface FilterTooltipContent {
  [key: string]: FilterTooltipInfo;
}

// ============================================
// CONFIGURACIÓN DEL CATÁLOGO v0.5
// Mayormente fija, basada en presentación v0.4
// ============================================

export type SkeletonVersion = 1 | 2 | 3;
export type LoadMoreVersion = 1 | 2 | 3;
export type LoadingDuration = 'default' | '30s' | '60s';
export type ImageGalleryVersion = 1 | 2 | 3;
export type GallerySizeVersion = 1 | 2 | 3;
export type TechnicalFiltersVersion = 1 | 2 | 3;

export const loadingDurationMs: Record<LoadingDuration, number> = {
  default: 800,
  '30s': 30000,
  '60s': 60000,
};

export interface CatalogConfig {
  // ========================================
  // CONFIGURACIÓN FIJA (no iterable en v0.5)
  // Valores de presentación v0.4
  // ========================================
  layoutVersion: 4;
  brandFilterVersion: 3;
  cardVersion: 6;
  technicalFiltersVersion: 3;
  columnsDesktop: 4;
  skeletonVersion: 2;
  loadingDuration: 'default';
  loadMoreVersion: 3;
  imageGalleryVersion: 2;
  gallerySizeVersion: 3;
  tagDisplayVersion: 1;
  showPricingOptions: false;
  pricingMode: 'static';
  defaultTerm: 24;
  defaultInitial: 10;
  showFilterCounts: true;
  showTooltips: true;
  productsPerRow: {
    mobile: 1;
    tablet: 2;
    desktop: 4;
  };

  // ========================================
  // CONFIGURACIÓN ITERABLE (única en v0.5)
  // ========================================
  colorSelectorVersion: ColorSelectorVersion;
}

export const defaultCatalogConfig: CatalogConfig = {
  // Fijos
  layoutVersion: 4,
  brandFilterVersion: 3,
  cardVersion: 6,
  technicalFiltersVersion: 3,
  columnsDesktop: 4,
  skeletonVersion: 2,
  loadingDuration: 'default',
  loadMoreVersion: 3,
  imageGalleryVersion: 2,
  gallerySizeVersion: 3,
  tagDisplayVersion: 1,
  showPricingOptions: false,
  pricingMode: 'static',
  defaultTerm: 24,
  defaultInitial: 10,
  showFilterCounts: true,
  showTooltips: true,
  productsPerRow: {
    mobile: 1,
    tablet: 2,
    desktop: 4,
  },

  // Iterable - default V1
  colorSelectorVersion: 1,
};

// ============================================
// Producto
// ============================================

export interface CatalogProduct {
  id: string;
  slug: string;
  name: string;
  displayName: string;
  brand: string;
  brandLogo?: string;
  thumbnail: string;
  images: string[];
  colors: ProductColor[]; // NUEVO: colores disponibles
  price: number;
  originalPrice?: number;
  discount?: number;
  quotaMonthly: number;
  quotaBiweekly: number;
  quotaWeekly: number;
  maxTermMonths: number;
  gama: GamaTier;
  condition: ProductCondition;
  stock: StockStatus;
  stockQuantity: number;
  usage: UsageType[];
  isFeatured: boolean;
  isNew: boolean;
  tags: ProductTagType[];
  specs: ProductSpecs;
  createdAt: string;
}

export interface ProductSpecs {
  processor: {
    brand: ProcessorBrand;
    model: string;
    cores: number;
    speed: string;
  };
  ram: {
    size: number;
    type: string;
    maxSize: number;
    expandable: boolean;
  };
  storage: {
    size: number;
    type: StorageType;
    hasSecondSlot: boolean;
  };
  display: {
    size: number;
    resolution: Resolution;
    resolutionPixels: string;
    type: DisplayType;
    refreshRate: number;
    touchScreen: boolean;
  };
  gpu: {
    type: GpuType;
    brand: string;
    model: string;
    vram?: number;
  };
  connectivity: {
    wifi: string;
    bluetooth: string;
    hasEthernet: boolean;
  };
  ports: {
    usb: number;
    usbC: number;
    hdmi: boolean;
    thunderbolt: boolean;
    sdCard: boolean;
    headphone: boolean;
  };
  keyboard: {
    backlit: boolean;
    numericPad: boolean;
    language: string;
  };
  security: {
    fingerprint: boolean;
    facialRecognition: boolean;
    tpmChip: boolean;
  };
  os: {
    hasWindows: boolean;
    windowsVersion?: string;
  };
  battery: {
    capacity: string;
    life: string;
  };
  dimensions: {
    weight: number;
    thickness: number;
  };
}

// ============================================
// Props de Componentes
// ============================================

export interface FilterCounts {
  brands: Record<string, number>;
  usage: Record<string, number>;
  ram: Record<number, number>;
  storage: Record<number, number>;
  storageType: Record<string, number>;
  processorBrand: Record<string, number>;
  displaySize: Record<number, number>;
  displayType: Record<string, number>;
  resolution: Record<string, number>;
  refreshRate: Record<number, number>;
  gpuType: Record<string, number>;
  gama: Record<string, number>;
  condition: Record<string, number>;
  stock: Record<string, number>;
}

export interface CatalogLayoutProps {
  products: CatalogProduct[];
  filters: FilterState;
  onFiltersChange: (filters: FilterState) => void;
  sort: SortOption;
  onSortChange: (sort: SortOption) => void;
  config: CatalogConfig;
  filterCounts?: FilterCounts;
  children?: ReactNode;
}

export interface BrandFilterProps {
  options: FilterOption[];
  selected: string[];
  onChange: (brands: string[]) => void;
  showCounts?: boolean;
}

export interface ColorSelectorProps {
  colors: ProductColor[];
  selectedColorId: string;
  onColorSelect: (colorId: string) => void;
  version?: ColorSelectorVersion;
}

export interface SortDropdownProps {
  value: SortOption;
  onChange: (value: SortOption) => void;
  totalProducts: number;
}

export interface FilterChipsProps {
  filters: AppliedFilter[];
  onRemove: (id: string) => void;
  onClearAll: () => void;
}
